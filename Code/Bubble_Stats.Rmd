---
title: "Bubble_Stats"
output: html_document
date: "2023-03-05"
---
#Load Packages
```{r}
library('tidyverse')
library('lme4')
library('lmerTest')
library("tidymodels")
library("ggtext")
library("ggpubr")

setwd("/Users/gracechungm/Desktop")
```

%>% select(c(shrimp_ID, video_ID, acc_hr, Temperature, use_SPL, max_SPL, body_mass_g, DactylLength_mm, use_distance, bubble_dist_mm, use_bubble, max_size_mm2, growth_ms, collapse_ms, rebound_ms))

# Set up
```{r}
bubble_df <- read.csv("/Users/gracechungm/Desktop/bubble_df.csv")

#Make avg dataframe
avgs_df <- data.frame(bubble_df)

avgs_df <- bubble_df %>%
  group_by(shrimp_ID) %>%
  summarize_each(funs(mean(., na.rm = TRUE))) %>% 
  select(c(shrimp_ID, Temperature, acc_hr, max_SPL, DactylLength_mm, bubble_dist_mm, max_size_mm2, growth_ms, collapse_ms, rebound_ms, col_rate_mm2pms))
```

#calcuate collapse rate and write to csv
```{r eval=FALSE, include=FALSE}
bubble_df$col_rate_mm2pms <-bubble_df$max_size_mm2/ bubble_df$collapse_ms

write.csv(bubble_df, "/Users/gracechungm/Desktop/bubble_df.csv", row.names=FALSE)
```

# One-way ANOVA of mean dactyl size across temperature 
(Is avg DL significantly different across the temperature treatments?)
```{r eval=FALSE, include=FALSE}
anova_dactyl <- aov(Temperature ~ DactylLength_mm, data = avgs_df)

summary(anova_dactyl)
```


linear_reg <- lm(y ~ x, data = df)

LMM <- lmer(y ~ x + (1 | random_effect), REML =F, data = df)

AIC(logLik(model))

r.squaredGLMM(fit1.lme)


# Other LMM testing temperature
```{r}
temp_df <- data.frame(bubble_df)

#BUBBLE DISTANCE
null <- lmer(bubble_dist_mm ~ (1 | shrimp_ID), REML =F, data = temp_df)
AIC(logLik(null))

distance <- lmer(bubble_dist_mm ~ Temperature + (1 | shrimp_ID), REML =F, data = temp_df)
AIC(logLik(distance))

distance_DL <- lmer(bubble_dist_mm ~ DactylLength_mm + (1 | shrimp_ID), REML =F, data = temp_df)
AIC(logLik(distance_DL))

temp_df$bubble_duration_s <- temp_df$growth_ms + temp_df$collapse_ms

#BUBBLE DURATION
null <- lmer(bubble_duration_s ~ (1 | shrimp_ID), REML =F, data = temp_df)
AIC(logLik(null))

bubble_duration <- lmer(bubble_duration_s ~ Temperature + (1 | shrimp_ID), REML =F, data = temp_df)
AIC(logLik(bubble_duration))

bubble_duratio_DL <- lmer(bubble_duration_s ~ DactylLength_mm + (1 | shrimp_ID), REML =F, data = temp_df)
AIC(logLik(bubble_duratio_DL))

```

# LMM for bubble size
```{r}
size_df <- bubble_df[!(bubble_df$use_bubble=="0"),]

#Null hyp: RE ID
size_null <- lmer(max_size_mm2 ~ (1 | shrimp_ID), REML =F, data = size_df)
AIC(logLik(size_null))

#FE T
size_temp <- lmer(max_size_mm2 ~ Temperature + (1 | shrimp_ID), REML =F, data = size_df)
summary(size_temp)
AIC(logLik(size_temp))

#FE DL
size_dactyl <- lmer(max_size_mm2 ~ DactylLength_mm + (1 | shrimp_ID), REML =F, data = size_df)
summary(size_dactyl)
AIC(logLik(size_dactyl))
#r.squaredGLMM(size_dactyl)

#FE DL+B
size_dactylPLUStemp <- lmer(max_size_mm2 ~ DactylLength_mm + Temperature + (1 | shrimp_ID), REML =F, data = size_df)
#summary(size_dactylPLUStemp)
AIC(logLik(size_dactylPLUStemp))

#FE body mass
size_body <- lmer(max_size_mm2 ~ body_mass_g + (1 | shrimp_ID), REML =F, data = size_df)
#summary(size_body)
AIC(logLik(size_body))
```
## A)Plotting: Bubble Size w/ DL 
```{r}
#Significant model = dactyl length
fun.size_dactyl = function(x) -17.781  + 7.481*x

text_size = 10
triangle_size = 1.5 
cross_size = 1.5

fig_size_dl <- ggplot(data = size_df, aes(x=DactylLength_mm, y=max_size_mm2)) +
  geom_point(aes(color="Raw"), shape = 3, size = cross_size) +
  geom_point(data = avgs_df, aes(color="Average"), shape= 17, size = triangle_size) +
  scale_color_manual(name=NULL, limits=c("Raw", "Average"), values = c("darkgray", "black")) +
  guides(color = guide_legend(override.aes = list(pch = c(3, 17), fill = c("darkgray", "black")))) +
  theme_classic() +
  theme(legend.position = c(0.85, 0.1),
        legend.text = element_text(size = text_size)) +
  stat_function(fun = fun.size_dactyl) +
  labs(x="Dactyl Length (mm)",
       y="")+
  scale_y_continuous(breaks = seq(0, 60, by = 10)) +
  scale_x_continuous(breaks = seq(0, 8, by = 1))

fig_size_dl
```
## B)Plotting: Bubble Size w/ Temperature 
```{r}
# NOT Significant

text_size = 10
triangle_size = 1.5 
cross_size = 1.5

fig_size_T <- ggplot(data = size_df, aes(x=Temperature, y=max_size_mm2)) +
  geom_point(aes(color="Raw"), shape = 3, size = cross_size) +
  geom_point(data = avgs_df, aes(color="Average"), shape= 17, size = triangle_size) +
  scale_color_manual(name=NULL, limits=c("Raw", "Average"), values = c("darkgray", "black")) +
  guides(color = guide_legend(override.aes = list(pch = c(3, 17), fill = c("darkgray", "black")))) +
  theme_classic() +
  theme(legend.position = c(0.85, 0.1),
        legend.text = element_text(size = text_size)) +
  labs(x="Temperature (°C)",
       y=bquote("Maximum Bubble Size "(mm^2)))+
  scale_y_continuous(breaks = seq(0, 60, by = 10)) +
  scale_x_continuous(breaks = c(12,15,20,25,30))
```
##Bubble size w/ Collapse Time
```{r}
#Null hyp: RE collapse_ms + ID
size_tc_null <- lmer(max_size_mm2 ~ (1 + collapse_ms|| shrimp_ID), REML =F, data = size_df)
AIC(logLik(size_tc_null))

#FE collapse_ms
size_tc <- lmer(max_size_mm2 ~ collapse_ms + (1 + collapse_ms|| shrimp_ID), REML =F, data = size_df)
summary(size_tc)
AIC(logLik(size_tc))
```
## C)Plotting: Bubble Size w/ Collapse Time
```{r}
#Significant model = Collapse Time
fun.size_tc = function(x) 4.548  + 76.413*x

text_size = 10
triangle_size = 1.5 
cross_size = 1.5

fig_size_tc <- ggplot(data = size_df, aes(x=collapse_ms, y=max_size_mm2)) +
  geom_point(aes(color="Raw"), shape = 3, size = cross_size) +
  geom_point(data = avgs_df, aes(color="Average"), shape= 17, size = triangle_size) +
  scale_color_manual(name=NULL, limits=c("Raw", "Average"), values = c("darkgray", "black")) +
  guides(color = guide_legend(override.aes = list(pch = c(3, 17), fill = c("darkgray", "black")))) +
  theme_classic() +
  theme(legend.position = c(0.85, 0.1),
        legend.text = element_text(size = text_size)) +
  stat_function(fun = fun.size_tc) +
  labs(x="Collapse Duration (s)",
       y="Maximum Bubble Size")+
  scale_y_continuous(breaks = seq(0, 70, by = 10)) +
  scale_x_continuous(breaks = seq(0, 1, by = 0.05))

fig_size_tc
```

# ARRANGE Bubble Size

ggarrange(fig_size_T, fig_size_dl, fig_size_tc, labels = c("A", "B", "C"),
          common.legend = TRUE, legend = "bottom",
          ncol = 2, nrow = 2)
          
```{r}
ggarrange(fig_size_T, fig_size_dl, labels = c("A", "B"),
          common.legend = TRUE, legend = "bottom",
          ncol = 2, nrow = 1)
```


# LMM for SPL
```{r}
SPL_df <- bubble_df[!(bubble_df$use_SPL=="0"),]

#Null hyp: RE ID
SPL_null <- lmer(max_SPL ~ (1 | shrimp_ID), REML =F, data = SPL_df)
#summary(SPL_null)
AIC(logLik(SPL_null))

#FE T, RE ID
SPL_temp <- lmer(max_SPL ~ Temperature + (1 | shrimp_ID), REML =F, data = SPL_df)
#summary(SPL_temp)
AIC(logLik(SPL_temp))

#FE DL, RE ID
SPL_dactyl <- lmer(max_SPL ~ DactylLength_mm + (1 | shrimp_ID), REML =F, data = SPL_df)
#summary(SPL_dactyl)
AIC(logLik(SPL_dactyl))

#FE T, RE ID + DL
SPL_tempANDdactyl <- lmer(max_SPL ~ Temperature + DactylLength_mm + (1 | shrimp_ID), REML =F, data = SPL_df)
#summary(SPL_tempANDdactyl)
AIC(logLik(SPL_tempANDdactyl))

#FE Body mass
SPL_mass <- lmer(max_SPL ~ body_mass_g + (1 | shrimp_ID), REML =F, data = SPL_df)
summary(SPL_mass)
AIC(logLik(SPL_mass))

```
##(A)Plotting: SPL w/ Temperature
```{r}
#NO Significant model = Temperature

text_size = 10
triangle_size = 1.5 
cross_size = 1.5

fig_spl_T <- ggplot(data = SPL_df, aes(x=Temperature, y=max_SPL)) +
  geom_point(aes(color="Raw"), shape = 3, size = cross_size) +
  geom_point(data = avgs_df, aes(color="Average"), shape= 17, size = triangle_size) +
  scale_color_manual(name=NULL, limits=c("Raw", "Average"), values = c("darkgrey", "black")) +
  guides(color = guide_legend(override.aes = list(pch = c(3, 17), fill = c("darkgrey", "black")))) +
  theme_classic() +
  theme(legend.position = c(0.8, 0.1),
        legend.text = element_text(size = text_size)) +
  labs(x="Temperature (°C)",
       y="")+
  scale_y_continuous(breaks = seq(150, 230, by = 10)) +
  scale_x_continuous(breaks = c(12,15,20,25,30))
```
##(B)Plotting: SPL w/ DL
```{r}
#NO Significant model = Dactyl Length

text_size = 10
triangle_size = 1.5 
cross_size = 1.5

fig_spl_dl <- ggplot(data = SPL_df, aes(x=DactylLength_mm, y=max_SPL)) +
  geom_point(aes(color="Raw"), shape = 3, size = cross_size) +
  geom_point(data = avgs_df, aes(color="Average"), shape= 17, size = triangle_size) +
  scale_color_manual(name=NULL, limits=c("Raw", "Average"), values = c("darkgrey", "black")) +
  guides(color = guide_legend(override.aes = list(pch = c(3, 17), fill = c("darkgrey", "black")))) +
  theme_classic() +
  theme(legend.position = c(0.8, 0.9),
        legend.text = element_text(size = text_size)) +
  labs(x="Dactyl Length (mm)",
       y="")+
  scale_y_continuous(breaks = seq(150,220, by = 10)) +
  scale_x_continuous(breaks = seq(0, 8, by = 1))
```
##SPL ~ Fixed Effect: Bubble Size
```{r}
#NULL HYP: RE B + ID
SPL_bubbleNULL <- lmer(max_SPL ~ (max_size_mm2 || shrimp_ID), REML =F, data = SPL_df)
#summary(SPL_bubbleNULL)
AIC(logLik(SPL_bubbleNULL))

#FE Bubble Size
SPL_bubble <- lmer(max_SPL ~ max_size_mm2 + (max_size_mm2 || shrimp_ID), REML =F, data = SPL_df)
summary(SPL_bubble)
AIC(logLik(SPL_bubble))

#FE T, RE B + ID
SPL_temp <- lmer(max_SPL ~ Temperature + (max_size_mm2 || shrimp_ID), REML =F, data = SPL_df)
#summary(SPL_temp)
AIC(logLik(SPL_temp))

```
###Quad regression
```{r eval=FALSE, include=FALSE}
#new variable: size^2
SPL_df$size2 <- SPL_df$max_size_mm2^2

#fit quadratic regression model
quadraticModel <- lm(max_SPL ~ max_size_mm2 + size2, data=SPL_df)

#view model summary
summary(quadraticModel)
```
###Quad mixed model, orthogonal polynomials NVM
```{r eval=FALSE, include=FALSE}
SPL_new <- SPL_df[!is.na(SPL_df$max_size_mm2),]

SPL_sizeQuad <- lmer(max_SPL ~ poly(max_size_mm2,2, raw=FALSE) + (poly(max_size_mm2,2, raw=FALSE)||shrimp_ID), data = SPL_new, REML = F)
summary(SPL_sizeQuad)
```



##(C) Plotting: SPL w/ Bubble size
```{r}
#Significant model = Bubble size
fun.SPL_size = function(x) 191.2322  + 0.5613*x

#quad regression
#fun.SPL_size = function(x) 190.10763  + 0.79742*x -0.00842*x*x

text_size = 10
triangle_size = 1.5 
cross_size = 1.5

fig_spl_size <- ggplot(data = SPL_df, aes(x=max_size_mm2, y=max_SPL)) +
  geom_point(aes(color="Raw"), shape = 3, size = cross_size) +
  geom_point(data = avgs_df, aes(color="Average"), shape= 17, size = triangle_size) +
  scale_color_manual(name=NULL, limits=c("Raw", "Average"), values = c("darkgrey", "black")) +
  guides(color = guide_legend(override.aes = list(pch = c(3, 17), fill = c("darkgrey", "black")))) +
  theme_classic() +
  theme(legend.position = c(0.85, 0.1),
        legend.text = element_text(size = text_size)) +
  stat_function(fun = fun.SPL_size) +
  labs(x=bquote("Maximum Bubble Size "(mm^2)),
       y="")+
  scale_y_continuous(breaks = seq(170, 220, by = 10)) +
  scale_x_continuous(breaks = seq(0, 70, by = 10))

```

# ARRANGE SPL (A, B, C)

final_SPL_fig <- ggarrange(fig_spl_T, fig_spl_dl, fig_spl_size, labels = c("A", "B", "C"), common.legend = TRUE, legend = "bottom", ncol = 2, nrow = 2)

```{r}
final_SPL_fig <- ggarrange(fig_spl_T, fig_spl_dl, fig_spl_size, labels = c("A", "B", "C"), common.legend = TRUE, legend = "bottom", ncol = 3, nrow = 1)

annotate_figure(final_SPL_fig, left = text_grob("Sound Pressure Level (dB re 1 µPa)", rot = 90),)
```



##SPL ~ Fixed Effect: Bubble Distance
```{r}
# NULL
SPL_d_NULL <- lmer(max_SPL ~ (bubble_dist_mm || shrimp_ID), REML =F, data = SPL_df)
# summary(SPL_d_NULL)
AIC(logLik(SPL_d_NULL))

#FE tc, RE ID + tc
SPL_d <- lmer(max_SPL ~ bubble_dist_mm + (bubble_dist_mm || shrimp_ID), REML =F, data = SPL_df)
# summary(SPL_d)
AIC(logLik(SPL_d))

```

##SPL ~ Fixed Effect: Collapse Time
```{r}
# NULL
SPL_tc_NULL <- lmer(max_SPL ~ (collapse_ms || shrimp_ID), REML =F, data = SPL_df)
# summary(SPL_tc_NULL)
AIC(logLik(SPL_tc_NULL))

#FE tc, RE ID + tc
SPL_tc2 <- lmer(max_SPL ~ collapse_ms + (collapse_ms || shrimp_ID), REML =F, data = SPL_df)
summary(SPL_tc2)
AIC(logLik(SPL_tc2))

#FE tc, RE ID + tc
SPL_tc3 <- lmer(max_SPL ~ Temperature + (collapse_ms || shrimp_ID), REML =F, data = SPL_df)
# summary(SPL_tc3)
AIC(logLik(SPL_tc3))

#Bubble size + Collapse time
SPL_BtcNULL <- lmer(max_SPL ~ (max_size_mm2 + collapse_ms || shrimp_ID), REML =F, data = SPL_df)
# summary(SPL_BtcNULL)
AIC(logLik(SPL_BtcNULL))

#Bubble size + Collapse time
SPL_Btc <- lmer(max_SPL ~ max_size_mm2 + collapse_ms + max_size_mm2*collapse_ms + (max_size_mm2 + collapse_ms || shrimp_ID), REML =F, data = SPL_df)
summary(SPL_Btc)
AIC(logLik(SPL_Btc))

# LINEAR REGRESSION
SPL_tc_lm <- lm(max_SPL ~ collapse_ms, data = SPL_df)
summary(SPL_tc_lm)
# AIC(logLik(SPL_tc_lm))

```
###Plotting SPL ~ Collapse time (NOPE)
```{r}
#Significant model = Bubble size
fun.SPL_tc = function(x) 195.350  + 28.503*x

#fun.SPL_tc = function(x) 192.454 + 51.931*x

#quad regression
#fun.SPL_size = function(x) 190.10763  + 0.79742*x -0.00842*x*x

text_size = 10
triangle_size = 1.5 
cross_size = 1.5

ggplot(data = SPL_df, aes(x=collapse_ms, y=max_SPL)) +
  geom_point(aes(color="Raw"), shape = 3, size = cross_size) +
  geom_point(data = avgs_df, aes(color="Average"), shape= 17, size = triangle_size) +
  scale_color_manual(name=NULL, limits=c("Raw", "Average"), values = c("black", "black")) +
  guides(color = guide_legend(override.aes = list(pch = c(3, 17), fill = c("black", "black")))) +
  theme_classic() +
  theme(legend.position = c(0.85, 0.1),
        legend.text = element_text(size = text_size)) +
  stat_function(fun = fun.SPL_tc) +
  labs(x=bquote("Collapse Time (s)"),
       y="Maximum Sound Pressure Level (dB)")+
  scale_y_continuous(breaks = seq(170, 220, by = 10)) +
  scale_x_continuous(breaks = seq(0, 1, by = 0.05))

```

##SPL ~ Fixed Effect: Collapse RATE
```{r}
SPL_colRate <- bubble_df[!is.na(bubble_df$col_rate_mm2pms),]

# NULL
SPL_cRate_NULL <- lmer(max_SPL ~ (col_rate_mm2pms || shrimp_ID), REML =F, data = SPL_colRate)
#summary(SPL_cRate_NULL)
AIC(logLik(SPL_cRate_NULL))

#FE Collapse rate
SPL_cRate <- lmer(max_SPL ~ col_rate_mm2pms + (col_rate_mm2pms || shrimp_ID), REML =F, data = SPL_colRate)
summary(SPL_cRate)
AIC(logLik(SPL_cRate))

#linear regression
SPL_lm_cRate <- lm(max_SPL ~ col_rate_mm2pms, data = SPL_colRate)
summary(SPL_lm_cRate)

```
##Plotting: SPL w/ Collapse Rate
```{r}
#Significant model = Collapse Rate
fun.SPL_colRatefn = function(x) 185.14720 + 0.13039*x

text_size = 10
triangle_size = 1.5 
cross_size = 1.5

ggplot(data = SPL_colRate, aes(x=col_rate_mm2pms, y=max_SPL)) +
  geom_point(aes(color="Raw"), shape = 3, size = cross_size) +
  geom_point(data = avgs_df, aes(color="Average"), shape= 17, size = triangle_size) +
  scale_color_manual(name=NULL, limits=c("Raw", "Average"), values = c("black", "black")) +
  guides(color = guide_legend(override.aes = list(pch = c(3, 17), fill = c("black", "black")))) +
  theme_classic() +
  theme(legend.position = c(0.85, 0.2),
        legend.text = element_text(size = text_size)) +
  stat_function(fun = fun.SPL_colRatefn) +
  labs(x=bquote("Collapse Rate "(mm^2 ~ µm^-1)),
       y=bquote("Maximum Sound Pressure Level (dB re 1 µPa)")) +
  scale_y_continuous(breaks = seq(0, 220, by = 10)) +
  scale_x_continuous(breaks = seq(0, 270, by = 50))

```

##SPL ~ Fixed Effect: Rebound Time (TO FIX)
```{r}
#FE tc, RE ID + tc
SPL_tr <- lmer(max_SPL ~ rebound_ms + (1| shrimp_ID), REML =F, data = SPL_df)
summary(SPL_tr)

#FE tc, RE ID + tc
SPL_tr2 <- lmer(max_SPL ~ rebound_ms + (1 + rebound_ms| shrimp_ID), REML =F, data = SPL_df)
summary(SPL_tr2)

```





# LMM for Collapse Rate
```{r}
rate_df <- bubble_df[!is.na(bubble_df$col_rate_mm2pms),]

#Null hyp: RE ID
rate_null <- lmer(col_rate_mm2pms ~ (1 | shrimp_ID), REML =F, data = rate_df)
AIC(logLik(rate_null))

#FE T
rate_temp <- lmer(col_rate_mm2pms ~ Temperature + (1 | shrimp_ID), REML =F, data = rate_df)
summary(rate_temp)
AIC(logLik(rate_temp))

#FE DL
rate_dactyl <- lmer(col_rate_mm2pms ~ DactylLength_mm + (1 | shrimp_ID), REML =F, data = rate_df)
summary(rate_dactyl)
AIC(logLik(rate_dactyl))
#r.squaredGLMM(rate_dactyl)

#FE DL+B
rate_dactylPLUStemp <- lmer(col_rate_mm2pms ~ DactylLength_mm + Temperature + (1 | shrimp_ID), REML =F, data = rate_df)
#summary(rate_dactylPLUStemp)
AIC(logLik(rate_dactylPLUStemp))

#FE body mass
rate_body <- lmer(col_rate_mm2pms ~ body_mass_g + (1 | shrimp_ID), REML =F, data = rate_df)
#summary(rate_body)
AIC(logLik(rate_body))
```
## Plotting: Collapse Rate w/ DL
```{r}
#Significant model = dactyl length
fun.rate_dactyl = function(x) -17.781  + 7.481*x

text_size = 10
triangle_size = 1.5 
cross_size = 1.5

fig_rate_dl <- ggplot(data = rate_df, aes(x=DactylLength_mm, y=col_rate_mm2pms)) +
  geom_point(aes(color="Raw"), shape = 3, size = cross_size) +
  geom_point(data = avgs_df, aes(color="Average"), shape= 17, size = triangle_size) +
  scale_color_manual(name=NULL, limits=c("Raw", "Average"), values = c("black", "black")) +
  guides(color = guide_legend(override.aes = list(pch = c(3, 17), fill = c("black", "black")))) +
  theme_classic() +
  theme(legend.position = c(0.85, 0.1),
        legend.text = element_text(size = text_size)) +
  stat_function(fun = fun.rate_dactyl) +
  labs(x="Dactyl Length (mm)",
       y="Collapse Rate (mm^2 µs^-1")+
  scale_y_continuous(breaks = seq(0, 10, by = 0.5)) +
  scale_x_continuous(breaks = seq(0, 8, by = 1))
```

#LMM for growth time [strike end --> max bubble size]
```{r}
growth_df <- bubble_df[!is.na(bubble_df$growth_ms),]

#Null hyp: RE ID
growth_null <- lmer(growth_ms ~ (1 | shrimp_ID), REML =F, data = growth_df)
#summary(growth_null)
AIC(logLik(growth_null))

#FE T, RE ID
growth_temp <- lmer(growth_ms ~ Temperature + (1 | shrimp_ID), REML =F, data = growth_df)
# summary(growth_temp)
AIC(logLik(growth_temp))

#FE DL, RE ID
growth_dactyl <- lmer(growth_ms ~ DactylLength_mm + (1 | shrimp_ID), REML =F, data = growth_df)
summary(growth_dactyl)
AIC(logLik(growth_dactyl))

lm_growth <- lm(growth_ms ~ DactylLength_mm, data = growth_df)

summary(lm_growth)

```

#LMM for collapse time [max bubble size --> first collapse]
```{r}
collapse_df <- bubble_df[!is.na(bubble_df$collapse_ms),]

#Null hyp: RE ID
collapse_null <- lmer(collapse_ms ~ (1 | shrimp_ID), REML =F, data = collapse_df)
# summary(collapse_null)
AIC(logLik(collapse_null))

#FE T, RE ID
collapse_temp <- lmer(collapse_ms ~ Temperature + (1 | shrimp_ID), REML =F, data = collapse_df)
# summary(collapse_temp)
AIC(logLik(collapse_temp))

#FE DL, RE ID
collapse_dactyl <- lmer(collapse_ms ~ DactylLength_mm + (1 | shrimp_ID), REML =F, data = collapse_df)
#summary(collapse_dactyl)
AIC(logLik(collapse_dactyl))

#FE T, RE ID + DL
collapse_tempANDdactyl <- lmer(collapse_ms ~ Temperature + DactylLength_mm + (1 | shrimp_ID), REML =F, data = collapse_df)
# summary(collapse_tempANDdactyl)
AIC(logLik(collapse_tempANDdactyl))

```

#LMM for rebound time [first collapse --> second collapse]
```{r}
rebound_df <- bubble_df[!is.na(bubble_df$rebound_ms),]

#Null hyp: RE ID
rebound_null <- lmer(rebound_ms ~ (1 | shrimp_ID), REML =F, data = rebound_df) 
# summary(rebound_null)
AIC(logLik(rebound_null))

#FE T, RE ID
rebound_temp <- lmer(rebound_ms ~ Temperature + (1 | shrimp_ID), REML =F, data = rebound_df)
# summary(rebound_temp)
AIC(logLik(rebound_temp))

#FE DL, RE ID
rebound_dactyl <- lmer(rebound_ms ~ DactylLength_mm + (1 | shrimp_ID), REML =F, data = rebound_df)
summary(rebound_dactyl)
AIC(logLik(rebound_dactyl))

#FE T, RE ID + DL
rebound_tempANDdactyl <- lmer(rebound_ms ~ Temperature + DactylLength_mm + (1 | shrimp_ID), REML =F, data = rebound_df)
# summary(rebound_tempANDdactyl)
AIC(logLik(rebound_tempANDdactyl))

```

#Plotting durations (ugly)
```{r}

#Significant model = Bubble size
fun.growth = function(x) 0.013080  + 0.029622*x
fun.collapse = function(x) -0.01678  + 0.03299*x
fun.rebound = function(x) -0.017434  + 0.040542*x

text_size = 10
triangle_size = 1.5 
cross_size = 1.5

avg_gr <- data.frame(avgs_df) 
avg_gr$duration <- avg_gr$growth_ms

avg_col <- data.frame(avgs_df) 
avg_col$duration <- avg_col$collapse_ms

avg_re <- data.frame(avgs_df) 
avg_re$duration <- avg_re$rebound_ms

gColor = "darkorange"
cColor = "blue"
rColor = "purple"
  
gShape = 0
cShape = 1
rShape = 5

fig_duration_dl <- ggplot(data = avg_gr, aes(x=DactylLength_mm, y=duration)) +
  geom_point(aes(color="Growth"), shape = gShape, size = cross_size) +
  geom_point(data = avg_col, aes(color="Collapse"), shape= cShape, size = triangle_size) +
  geom_point(data = avg_re, aes(color="Rebound"), shape= rShape, size = triangle_size) +
  scale_color_manual(name=NULL, limits=c("Growth", "Collapse", "Rebound"), values = c(gColor, cColor, rColor)) +
  guides(color = guide_legend(override.aes = list(pch = c(gShape, cShape, rShape), fill = c(gColor, cColor, rColor)))) +
  theme_classic() +
  theme(legend.position = c(0.85, 0.2),
        legend.text = element_text(size = text_size)) +
  stat_function(fun = fun.growth, colour = gColor) +
  stat_function(fun = fun.collapse, colour = cColor) +
  stat_function(fun = fun.rebound, colour = rColor) +
  labs(x=bquote("Dactyl Length "(mm)),
       y="Time (ms)")+
  scale_y_continuous(breaks = seq(0, 5, by = 0.05))

fig_duration_dl

```


#ARRANGE Template
```{r}
# ggarrange(fig_spl_T, fig_spl_dl, fig_spl_size, labels = c("A", "B", "C"),
#           common.legend = TRUE, legend = "bottom",
#           ncol = 2, nrow = 2)
```

